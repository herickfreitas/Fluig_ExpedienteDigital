<html>

<head>

	<title>Expediente digital</title>

	<meta http-equiv="Content-Language" content="pt-br">
	<link type="text/css" rel="stylesheet" href="/style-guide/css/fluig-style-guide.min.css" />
	<script type="text/javascript" src="/portal/resources/js/jquery/jquery.js"></script>
	<script type="text/javascript" src="/portal/resources/js/jquery/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/portal/resources/js/mustache/mustache-min.js"></script>
	<script type="text/javascript" src="/style-guide/js/fluig-style-guide.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="custom.js"></script>
	<script src="/webdesk/vcXMLRPC.js"></script>


</head>

<body>
	<div class="fluig-style-guide">
		<form name="formExpedienteDigital" role="form">
			<div class="fluig-style-guide">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h2 class="panel-title">DESPACHOS E ENCAMINHAMENTOS</h2>
					</div>

					<div class="panel-body">
						<div class="container-fluid">
							<div class="alert alert-danger" id="error" role="alert" style="display:none"></div>
							<input type='hidden' name='usuarioCorrente' id='usuarioCorrente' />
							<input type='hidden' name='solicitante' id='solicitante' />
							<input type='hidden' name='gestorAnterior' id='gestorAnterior' />
							<input type='hidden' name='dataSolicitacao' id='dataSolicitacao' />
							<input type='hidden' name='identificadorFluig' id='identificadorFluig' />
							<input type='hidden' name='gestorLogado' id='gestorLogado' />
							
							
				
					<div class="row form-group" id="dvGestor">
						
						
						<div class="panel-body">
							<div class="alert alert alert-warning" role="alert">
								<strong>Atenção!!</strong> Selecione um Gestor/Assessor ou um Empregado subordinado para direcionar o expediente.
							</div>
						</div>
						
						<div class="col-xs-6 col-md-6"> 
							<label class="control-label" id="lblGestor">Selecione um Gestor ou Assessor</label>
								<input  type="zoom"
								id = "gestor"
								name="gestor"
								data-zoom="{
											'displayKey':'CODUSUARIO_CHEFE',
											'datasetId':'_RM_GESTORES',
											'maximumSelectionLength':'1',
											'fields':[
												{
												'field':'CHEFE',  
												'label':'Gestor',
												'standard':'true'
												},{
												'field':'CODUSUARIO_CHEFE',
												'label':'Cod usuario'
												}
											]
										}"
										/>
						</div>
						
						<div class="col-xs-6 col-md-6"> 
						<label class="control-label" id="lblcolaborador">Selecione um Empregado subordinado </label>
						<input 
							type="zoom"
							id = "colaborador"
							name="colaborador"
							data-zoom="{
								'displayKey':'CODUSUARIO',
								'datasetId':'_RM_COLABORADORES',
								'maximumSelectionLength':'1',
								'fields':[
									{
									  'field':'COLABORADOR',
									  'label':'COLABORADOR'
									},{
									  'field':'CODUSUARIO',
									  'label':'CODUSUARIO',
									  'standard':'true'
									}
								]
							}"
						/>
						</div>
						
					</div>



					<br><br>
					

							<div class="row form-group">
								<div class="col-xs-12 col-md-12">
									<label class="control-label" id="lblAssunto">Assunto</label>
									<input class="form-control" type="text" name="assunto" id="assunto" />
								</div>
							</div>

							<div class="row form-group">
								<div class="col-xs-12 col-md-12">
									<label class="control-label" id="lblDespacho">Despacho</label>
									<textarea class="form-control" rows="10" name="despacho" id="despacho"></textarea>
								</div>
							</div>

							<div class="row form-group">
								<div class="col-xs-12 col-md-12">
									<label class="control-label" id="lblHistoricoDespacho">Histórico do Despacho</label>
									<textarea class="form-control" rows="60" name="historicoDespacho" id="historicoDespacho" readonly></textarea>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>

		</form>
			<script>
				// carrega o form com um timeout  
				$(document).ready(function () {
					setTimeout(function () {
						LoadForm();
						$('#loading').hide();
					}, 500);
					});
				
			    function LoadForm() {
      				try {
							// Ocultando seleção, será habilitada caso seja um gestor.
							$('#dvGestor').hide();
						
							
							//Chamada do usuário corrente através da API
							//http://minhahomolog.cnc.org.br/api/public/2.0/users/getCurrent
							

							// capturando usuario logado
							//var wcmapi = parent.WCMAPI;
							//var usuarioLogado = wcmapi.getUserCode();
							//usuarioLogado = usuarioLogado.toLowerCase();
							//console.log("Form usuarioLogado: "+usuarioLogado);

							// capturando usuario logado
							var usuarioLogado = document.getElementById("usuarioCorrente").value;
							usuarioLogado = usuarioLogado.toLowerCase();
							console.log("Form usuarioLogado: "+usuarioLogado);

							
							var gestorLogado = false; // true é um gestor logado, false não é um, gestor logado
							
							var datasetGestor = DatasetFactory.getDataset("_RM_GESTORES", null, null, null); // Buscando dataset gestores
							var records = datasetGestor.values; // Gravando valores de retorno

							var gestorRetornado = "";
							for (var index in records) {
								var record = records[index];
								gestorRetornado = record.CODUSUARIO_CHEFE;
								//Verificando se usuário logado foi retornado na busca
								if (usuarioLogado == gestorRetornado) {
									gestorLogado = true;
									//console.log(" IF ENTROU: usuarioLogado == gestorRetornado ");
									}
							}
							
							if (gestorLogado == true) {
								console.log(" IF ENTROU: gestorLogado == true ");
								$("#gestorLogado").val(true);
								// Habilitando seleção para gestores
								$('#dvGestor').show();
								// Filtrando colaboradores
								filtrazoom(usuarioLogado);
								
							}
							else if (gestorLogado == false) {
								$("#gestorLogado").val(false);
							}
						
						}
					
							catch (e) {
							$('#error').show();
							$('#error').html("Erro: " + e.message);
						}
					}

			</script>

	</div>
</body>

</html>